
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head}"></head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<main class="main-content">
    <div class="container" style="max-width: 1400px;">

        <!-- Personalized Header -->
        <div style="margin-bottom: var(--spacing-2xl);">
            <h1 style="font-size: 2.5rem; font-weight: 700; color: var(--text-primary); margin-bottom: var(--spacing-sm);">
                <span th:text="${greeting}">Guten Morgen</span>, <span id="userName">Dave</span>
            </h1>
            <p style="color: var(--text-secondary); font-size: 1.1rem;">
                Hier ist deine Übersicht für heute
            </p>
        </div>

        <!-- Widget Grid -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: var(--spacing-xl);">

            <!-- Quick Actions Widget -->
            <div class="card">
                <h3 class="card-title">
                    <i class="fas fa-bolt"></i> Schnellaktionen
                </h3>
                <div class="card-body">
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                        <a href="/applications/new" class="btn btn-primary" style="width: 100%; justify-content: center;">
                            <i class="fas fa-plus"></i> Neue Bewerbung
                        </a>
                        <a href="/applications" class="btn btn-secondary" style="width: 100%; justify-content: center;">
                            <i class="fas fa-list"></i> Alle Bewerbungen
                        </a>
                        <a href="/profile" class="btn btn-secondary" style="width: 100%; justify-content: center;">
                            <i class="fas fa-user"></i> Profil bearbeiten
                        </a>
                    </div>
                </div>
            </div>

            <!-- Calendar Widget (Placeholder) -->
            <div class="card">
                <h3 class="card-title">
                    <i class="fas fa-calendar-alt"></i> Kalender
                </h3>
                <div class="card-body">
                    <div style="text-align: center; padding: var(--spacing-xl); color: var(--text-secondary);">
                        <i class="fas fa-calendar" style="font-size: 3rem; margin-bottom: var(--spacing-md); opacity: 0.3;"></i>
                        <p style="margin: 0; font-weight: 600;">Kalender-Widget</p>
                        <p style="font-size: 0.875rem; margin-top: var(--spacing-xs);">Termine & Fristen im Überblick</p>
                        <p style="font-size: 0.75rem; margin-top: var(--spacing-md); color: var(--text-tertiary);">Coming soon...</p>
                    </div>
                </div>
            </div>

            <!-- Vacation Planning Widget (Placeholder) -->
            <div class="card">
                <h3 class="card-title">
                    <i class="fas fa-umbrella-beach"></i> Urlaubsplanung
                </h3>
                <div class="card-body">
                    <div style="text-align: center; padding: var(--spacing-xl); color: var(--text-secondary);">
                        <i class="fas fa-plane-departure" style="font-size: 3rem; margin-bottom: var(--spacing-md); opacity: 0.3;"></i>
                        <p style="margin: 0; font-weight: 600;">Urlaubsverwaltung</p>
                        <p style="font-size: 0.875rem; margin-top: var(--spacing-xs);">Urlaub planen & verwalten</p>
                        <p style="font-size: 0.75rem; margin-top: var(--spacing-md); color: var(--text-tertiary);">Coming soon...</p>
                    </div>
                </div>
            </div>

            <!-- Documents Widget (Placeholder) -->
            <div class="card">
                <h3 class="card-title">
                    <i class="fas fa-folder"></i> Dokumente
                </h3>
                <div class="card-body">
                    <div style="text-align: center; padding: var(--spacing-xl); color: var(--text-secondary);">
                        <i class="fas fa-file-pdf" style="font-size: 3rem; margin-bottom: var(--spacing-md); opacity: 0.3;"></i>
                        <p style="margin: 0; font-weight: 600;">Dokumenten-Management</p>
                        <p style="font-size: 0.875rem; margin-top: var(--spacing-xs);">Lebenslauf, Zeugnisse & mehr</p>
                        <p style="font-size: 0.75rem; margin-top: var(--spacing-md); color: var(--text-tertiary);">Coming soon...</p>
                    </div>
                </div>
            </div>

        </div>

    </div>
</main>

<div th:replace="~{fragments/footer :: footer}"></div>
<script>
    // ✅ Dashboard Protection - Check ob User eingeloggt ist
    function checkAuth() {
        const token = localStorage.getItem('token');

        if (!token) {
            // Kein Token → Redirect zu Login
            console.log('No token found, redirecting to login...');
            window.location.href = '/login';
            return false;
        }

        console.log('Token found, user is authenticated');
        return true;
    }

    // User Info aus localStorage laden
    function loadUserInfo() {
        const user = JSON.parse(localStorage.getItem('user'));

        if (user && user.fullName) {
            const firstName = user.fullName.split(' ')[0];
            document.getElementById('userName').textContent = firstName;
            console.log('User loaded:', firstName);
        } else {
            // Fallback - versuche aus Token zu laden
            const token = localStorage.getItem('token');
            if (token) {
                // Token ist da, aber kein User - nimm Default
                document.getElementById('userName').textContent = 'Nutzer';
            } else {
                document.getElementById('userName').textContent = 'Dave';
            }
        }
    }

    // Beim Laden der Seite ausführen
    document.addEventListener('DOMContentLoaded', function() {
        // Zuerst Auth checken
        if (checkAuth()) {
            // Dann User Info laden
            loadUserInfo();
        }
    });
</script>

</body>
</html>